<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å››åœ‹æ…¢æ—… 2026</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        /* åŸºç¤æ¨£å¼ */
        :root { --bg-color: #f4f1ea; --primary: #5d7d45; --secondary: #d48e6c; --card-bg: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg-color); color: #4a4a4a; margin: 0; padding-bottom: 90px; -webkit-tap-highlight-color: transparent; }
        
        /* Header & Nav */
        header { background: var(--primary); color: white; padding: 20px; text-align: center; position: sticky; top: 0; z-index: 100; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #eee; z-index: 200; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-item { text-align: center; font-size: 0.8rem; color: #999; cursor: pointer; transition: 0.2s; }
        .nav-item.active { color: var(--primary); font-weight: bold; transform: scale(1.1); }
        
        /* Containers & Cards */
        .container { padding: 15px; display: none; animation: fadeIn 0.3s ease; }
        .container.active { display: block; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 16px; margin-bottom: 16px; border-left: 5px solid var(--primary); box-shadow: 0 4px 12px rgba(93, 125, 69, 0.15); position: relative; }
        .card h3 { margin: 0 0 8px; font-size: 1.1rem; }
        .desc { font-size: 0.9rem; color: #666; margin-bottom: 10px; line-height: 1.5; }
        
        /* Buttons & Inputs */
        .btn { padding: 10px; border: none; border-radius: 10px; cursor: pointer; width: 100%; margin-top: 8px; background: var(--primary); color: white; font-size: 0.9rem; font-weight: bold; }
        .btn:active { transform: scale(0.98); }
        input { padding: 12px; width: 100%; box-sizing: border-box; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; }
        
        /* List */
        ul { list-style: none; padding: 0; }
        li { background: #fff; border-bottom: 1px solid #eee; padding: 12px 5px; display: flex; justify-content: space-between; align-items: center; }
        .amount { font-weight: bold; color: var(--secondary); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>
    <h1>å››åœ‹æ…¢æ—… 2026</h1>
    <p>02/27 - 03/07 | 10å¤©9å¤œ</p>
</header>

<div id="tab-itinerary" class="container active">
    <div class="card">
        <h3>Day 1: æŠµé” & é‡‘åˆ€æ¯”ç¾…å®®</h3>
        <div class="desc">10:30 æŠµé”é«˜æ¾ã€‚ç§Ÿè»Šå¾Œå‰å¾€æ£®å®¶çƒé¾éºµã€‚ä¸‹åˆæŒ‘æˆ°é‡‘åˆ€æ¯”ç¾…å®® 785 éšã€‚</div>
        <button class="btn" onclick="window.open('https://www.google.com/maps/search/?api=1&query=é‡‘åˆ€æ¯”ç¾…å®®')">ğŸ—ºï¸ å°èˆªï¼šé‡‘åˆ€æ¯”ç¾…å®®</button>
    </div>
    <div class="card">
        <h3>Day 3: é³´é–€æ¼©æ¸¦ (é‡é»!)</h3>
        <div class="desc">âš ï¸ 11:30 æ˜¯æœ€ä½³è§€è³æ™‚é–“ï¼Œè«‹å‹™å¿…æº–æ™‚æŠµé”é³´é–€ã€‚</div>
        <button class="btn" onclick="window.open('https://www.google.com/maps/search/?api=1&query=é³´é–€æ¸¦ä¹‹é“')">ğŸ—ºï¸ å°èˆªï¼šé³´é–€æ¸¦ä¹‹é“</button>
    </div>
    <div style="text-align:center; color:#999; margin-top:20px; font-size:0.8rem;">(å®Œæ•´è¡Œç¨‹è«‹åƒé–± PDF)</div>
</div>

<div id="tab-tools" class="container">
    <div class="card" style="border-left-color: var(--secondary);">
        <h3>ğŸ’° å…±åŒè¨˜å¸³</h3>
        <input type="text" id="expense-desc" placeholder="æ¶ˆè²»é …ç›® (ä¾‹å¦‚: åˆé¤)">
        <input type="number" id="expense-amount" placeholder="é‡‘é¡ (æ—¥å¹£)" inputmode="numeric">
        <button class="btn" style="background: var(--secondary);" onclick="addExpense()">â• æ–°å¢æ”¯å‡º</button>
    </div>

    <div class="card">
        <h3 style="display:flex; justify-content:space-between;">
            <span>æ”¯å‡ºåˆ—è¡¨</span>
            <span style="font-size:0.9rem; color:#888;" id="status">é€£ç·šä¸­...</span>
        </h3>
        <ul id="expense-list">
            </ul>
        <div style="text-align:right; margin-top:15px; font-weight:bold; font-size:1.1rem; border-top:2px dashed #eee; padding-top:10px;">
            ç¸½è¨ˆ: Â¥<span id="total-amount" style="color:var(--secondary);">0</span>
        </div>
    </div>
</div>

<nav class="nav-bar">
    <div class="nav-item active" onclick="switchTab('itinerary', this)">ğŸ“… è¡Œç¨‹</div>
    <div class="nav-item" onclick="switchTab('tools', this)">ğŸ’° è¨˜å¸³</div>
</nav>

<script type="module">
  // æ”¹ç”¨ CDN é€£çµï¼Œç€è¦½å™¨æ‰çœ‹å¾—æ‡‚
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

  // æ‚¨çš„å°ˆå±¬è¨­å®š
  const firebaseConfig = {
    apiKey: "AIzaSyDVjPhieb7LVZAwtKjg1tpmZ6TE9Ti6g14",
    authDomain: "shikoku-trip-2026.firebaseapp.com",
    projectId: "shikoku-trip-2026",
    storageBucket: "shikoku-trip-2026.firebasestorage.app",
    messagingSenderId: "332889284995",
    appId: "1:332889284995:web:686e325c99a2ecfa0316b6",
    measurementId: "G-4LCZND97JT"
  };

  // åˆå§‹åŒ– Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const analytics = getAnalytics(app);

  console.log("Firebase initialized!");
  document.getElementById('status').innerText = "å·²é€£ç·š";

  // æ–°å¢æ”¯å‡ºåŠŸèƒ½
  window.addExpense = async function() {
      const desc = document.getElementById('expense-desc').value;
      const amount = Number(document.getElementById('expense-amount').value);
      
      if(desc && amount) {
          try {
              document.getElementById('status').innerText = "å„²å­˜ä¸­...";
              await addDoc(collection(db, "expenses"), {
                  desc: desc,
                  amount: amount,
                  timestamp: serverTimestamp()
              });
              // æ¸…ç©ºæ¬„ä½
              document.getElementById('expense-desc').value = '';
              document.getElementById('expense-amount').value = '';
              document.getElementById('status').innerText = "å„²å­˜æˆåŠŸ!";
              setTimeout(() => document.getElementById('status').innerText = "å·²é€£ç·š", 2000);
          } catch (e) {
              console.error("Error: ", e);
              alert('ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯');
          }
      } else {
          alert("è«‹è¼¸å…¥é …ç›®å’Œé‡‘é¡");
      }
  }

  // å³æ™‚ç›£è½è³‡æ–™åº«
  const q = query(collection(db, "expenses"), orderBy("timestamp", "desc"));
  onSnapshot(q, (snapshot) => {
      const list = document.getElementById('expense-list');
      const totalEl = document.getElementById('total-amount');
      list.innerHTML = '';
      let total = 0;
      
      snapshot.forEach((doc) => {
          const data = doc.data();
          const safeAmount = data.amount ? data.amount : 0; // é˜²æ­¢éŒ¯èª¤è³‡æ–™
          total += safeAmount;
          list.innerHTML += `
            <li>
                <span>${data.desc}</span> 
                <span class="amount">Â¥${safeAmount.toLocaleString()}</span>
            </li>`;
      });
      totalEl.innerText = total.toLocaleString();
  });

  // Tab åˆ‡æ›
  window.switchTab = function(tabId, navEl) {
      document.querySelectorAll('.container').forEach(el => el.classList.remove('active'));
      document.getElementById('tab-' + tabId).classList.add('active');
      document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
      navEl.classList.add('active');
  }
</script>

</body>
</html>