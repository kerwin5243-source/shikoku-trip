<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 å››åœ‹å·¡ç¦®</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#F2F2F7">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- V3.0 é¢¨æ ¼åŸºç¤ (Zen Tech) --- */
        :root {
            --bg-body: #F2F2F7;
            --bg-card: #FFFFFF;
            --primary: #007AFF; /* iOS Blue */
            --accent: #FF9500; /* Highlight Orange */
            --text-main: #1C1C1E;
            --text-sec: #8E8E93;
            --divider: #E5E5EA;
            --radius-L: 20px;
            --radius-M: 16px;
            --radius-S: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.06);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 110px; /* é¿é–‹åº•éƒ¨å°èˆª */
            overscroll-behavior-y: none;
        }
        
        /* é–å®šèƒŒæ™¯æ²å‹• (ä¿®å¾©æ»‘å‹•å•é¡Œ) */
        body.body-no-scroll { overflow: hidden; }

        /* --- Header --- */
        .app-header {
            padding: 50px 20px 10px;
            background: var(--bg-body);
        }
        .app-header h1 {
            margin: 0; font-size: 2rem; font-weight: 900; letter-spacing: -0.5px;
            color: var(--text-main);
        }
        .app-header p {
            margin: 5px 0 0; font-size: 0.9rem; color: var(--text-sec); font-weight: 500;
        }

        /* --- Layout & Cards --- */
        .page { display: none; padding: 0 20px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--bg-card); border-radius: var(--radius-L);
            padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow);
        }
        .section-title {
            font-size: 1.1rem; font-weight: 700; margin-bottom: 15px; color: var(--text-main);
            display: flex; align-items: center; gap: 8px;
        }

        /* --- Page 1: è¡Œå‰æº–å‚™ --- */
        .todo-item {
            display: flex; align-items: flex-start; gap: 12px; padding: 12px 0; border-bottom: 1px solid #eee;
        }
        .todo-checkbox {
            width: 22px; height: 22px; border-radius: 6px; border: 2px solid #ddd; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center; margin-top: 2px;
        }
        .todo-checkbox.checked { background: var(--primary); border-color: var(--primary); }
        .todo-checkbox i { color: white; font-size: 14px; display: none; }
        .todo-checkbox.checked i { display: block; }
        
        .user-tabs { display: flex; gap: 8px; margin-bottom: 15px; background: #E5E5EA; padding: 4px; border-radius: 12px; }
        .user-tab { flex: 1; text-align: center; padding: 8px 0; border-radius: 9px; font-size: 0.9rem; font-weight: 600; color: var(--text-sec); cursor: pointer; }
        .user-tab.active { background: white; color: var(--text-main); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .checklist-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .check-item {
            background: #F9F9F9; border-radius: 12px; padding: 12px 5px; text-align: center;
            font-size: 0.8rem; font-weight: 500; display: flex; flex-direction: column; align-items: center; gap: 6px;
            border: 2px solid transparent; cursor: pointer;
        }
        .check-item.checked { background: #E8F5E9; border-color: #34C759; color: #2E7D32; }
        .check-item i { font-size: 1.2rem; color: #ccc; }
        .check-item.checked i { color: #34C759; }

        /* --- Page 2: è¡Œç¨‹è¡¨ --- */
        .date-scroller {
            display: flex; gap: 10px; overflow-x: auto; padding: 10px 20px 20px; margin: 0 -20px; scrollbar-width: none;
        }
        .date-chip {
            flex: 0 0 auto; background: white; border-radius: 25px; padding: 10px 0; width: 75px; text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: 0.2s; cursor: pointer; border: 2px solid transparent;
        }
        .date-chip .day { font-size: 0.7rem; color: var(--text-sec); font-weight: 700; text-transform: uppercase; }
        .date-chip .date { font-size: 1.2rem; font-weight: 800; color: var(--text-main); line-height: 1.1; }
        .date-chip.active { background: var(--primary); transform: scale(1.05); box-shadow: 0 8px 20px rgba(0,122,255,0.3); }
        .date-chip.active .day, .date-chip.active .date { color: white; }

        .weather-banner {
            display: flex; justify-content: space-between; align-items: center; 
            background: linear-gradient(135deg, #6DD5FA, #2980B9); color: white;
            padding: 15px 20px; border-radius: 16px; margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.2);
        }

        .timeline-item { display: flex; gap: 15px; margin-bottom: 20px; cursor: pointer; }
        .tl-time { width: 50px; text-align: right; font-family: 'Roboto Mono', monospace; font-weight: 600; color: var(--text-sec); font-size: 0.9rem; padding-top: 5px; }
        .tl-card {
            flex: 1; background: white; padding: 15px; border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.02);
            transition: transform 0.1s;
        }
        .tl-card:active { transform: scale(0.98); background: #fafafa; }
        .tl-tag { display: inline-block; padding: 3px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 700; margin-bottom: 5px; }
        .tag-food { background: #FFF3E0; color: #FF9500; }
        .tag-sight { background: #E8F5E9; color: #34C759; }
        .tag-transport { background: #E3F2FD; color: #007AFF; }
        .tag-shop { background: #FFEBEE; color: #FF3B30; }
        .tag-hotel { background: #F3E5F5; color: #9C27B0; }

        /* --- Modal (Bottom Sheet) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; opacity: 0; pointer-events: none; transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        .modal-sheet {
            position: fixed; left: 0; right: 0; bottom: 0; height: 90vh; background: white;
            z-index: 2001; border-radius: 24px 24px 0 0; transform: translateY(100%);
            transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1); display: flex; flex-direction: column;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-sheet.active { transform: translateY(0); }
        .modal-drag { width: 40px; height: 5px; background: #E5E5EA; border-radius: 10px; margin: 12px auto; flex-shrink: 0; }
        .modal-scroll { flex: 1; overflow-y: auto; padding: 0 24px 40px; }
        
        .modal-img { width: 100%; height: 200px; object-fit: cover; border-radius: 16px; margin-bottom: 20px; background: #eee; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .info-box { background: #F2F2F7; padding: 10px; border-radius: 10px; }
        .menu-box { background: #FFF8E1; border: 1px solid #FFE082; padding: 15px; border-radius: 12px; margin-bottom: 20px; }

        /* --- Page 3: ä½å®¿/è³‡è¨Š --- */
        .hotel-card { background: white; border-radius: 20px; overflow: hidden; margin-bottom: 20px; box-shadow: var(--shadow); }
        .hotel-img-header { height: 160px; width: 100%; object-fit: cover; }
        .hotel-body { padding: 15px; }
        .hotel-tag { display: inline-block; background: #FFEBEE; color: #D32F2F; font-size: 0.75rem; padding: 4px 8px; border-radius: 6px; font-weight: 700; margin-top: 5px; }

        /* --- Page 4: è¨˜å¸³ --- */
        .money-input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .money-input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 12px; font-size: 1rem; }
        .payer-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; }
        .payer-chip { flex: 1; text-align: center; padding: 10px; border: 1px solid #eee; border-radius: 30px; color: var(--text-sec); font-weight: 600; cursor: pointer; }
        .payer-chip.active { background: var(--text-main); color: white; border-color: var(--text-main); }
        .debt-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }

        /* --- Bottom Nav --- */
        .bottom-nav {
            position: fixed; bottom: 25px; left: 20px; right: 20px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(20px);
            border-radius: 40px; display: flex; justify-content: space-around; padding: 12px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); z-index: 1000;
            border: 1px solid rgba(255,255,255,0.5);
        }
        .nav-item { text-align: center; color: #C7C7CC; font-size: 0.7rem; flex: 1; transition: 0.2s; cursor: pointer; }
        .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 4px; }
        .nav-item.active { color: var(--text-main); transform: translateY(-2px); }

        /* Buttons */
        .btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: 700; font-size: 1rem; }
        .btn-outline { background: transparent; border: 1px solid var(--text-main); color: var(--text-main); }
    </style>
</head>
<body>

    <header class="app-header">
        <h1>2026 å››åœ‹å·¡ç¦®</h1>
        <p>9å¤©8å¤œ â€¢ L, K, R, Y, J</p>
    </header>

    <div id="page-pre" class="page active">
        <div class="card" style="border: 2px solid var(--primary);">
            <div class="section-title" style="color:var(--primary);"><i class="fas fa-bullhorn"></i> å…¨å“¡é‡è¦å¾…è¾¦</div>
            <div id="common-todos"></div>
        </div>

        <div class="card">
            <div class="section-title">
                <i class="fas fa-suitcase"></i> å€‹äººè¡Œæ
                <div class="user-tabs" id="userSwitch" style="margin-left:auto; width:60%; margin-bottom:0;"></div>
            </div>
            
            <h4 style="margin:15px 0 10px; color:var(--text-sec);">éš¨èº«æ”œå¸¶</h4>
            <div class="checklist-grid" id="list-carry"></div>
            
            <h4 style="margin:20px 0 10px; color:var(--text-sec);">è¨—é‹è¡Œæ</h4>
            <div class="checklist-grid" id="list-check"></div>
        </div>
    </div>

    <div id="page-itinerary" class="page">
        <div class="date-scroller" id="dayScroller"></div>

        <div class="card" style="margin-top: 15px; padding: 15px;">
            <div class="weather-banner">
                <div>
                    <h2 style="margin:0; font-size:1.4rem;" id="weatherCity">é«˜æ¾å¸‚</h2>
                    <div style="font-size:0.9rem; opacity:0.9;">â˜€ï¸ 8Â°C - 15Â°C</div>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:0.75rem; text-transform:uppercase; opacity:0.8;">Stay At</div>
                    <div style="font-weight:700;" id="stayHotel">Second Home</div>
                </div>
            </div>
            
            <div style="display:flex; overflow-x:auto; gap:15px; padding-bottom:5px; scrollbar-width:none;" id="weatherStrip"></div>
        </div>

        <div id="timelineList" style="padding-bottom: 20px;"></div>
    </div>

    <div id="page-info" class="page">
        <div class="section-title">èˆªç­è³‡è¨Š</div>
        <div class="card">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span style="font-weight:700; color:#D32F2F;">å»ç¨‹ 02/27 (CI 278)</span>
                <span>07:00 TPE â” 10:20 TAK</span>
            </div>
            <div style="border-top:1px dashed #ddd; margin:10px 0;"></div>
            <div style="display:flex; justify-content:space-between;">
                <span style="font-weight:700; color:#1976D2;">å›ç¨‹ 03/07 (CI 179)</span>
                <span>18:55 TAK â” 21:05 TPE</span>
            </div>
        </div>

        <div class="section-title">ä½å®¿åˆ—è¡¨</div>
        <div id="hotelList"></div>
    </div>

    <div id="page-money" class="page">
        <div class="card">
            <div class="section-title">æ–°å¢æ”¯å‡º</div>
            <div class="money-input-row">
                <input type="text" id="exName" class="money-input" placeholder="é …ç›® (ä¾‹: æ™šé¤)">
                <input type="number" id="exCost" class="money-input" placeholder="é‡‘é¡ (Â¥)">
            </div>
            <p style="font-size:0.9rem; color:#888; margin-bottom:8px;">èª°å…ˆä»˜æ¬¾ï¼Ÿ</p>
            <div class="payer-row" id="payerSwitch"></div>
            <button class="btn" style="margin-top:15px;" onclick="addExpense()">åŠ å…¥ç´€éŒ„ (5äººå¹³åˆ†)</button>
        </div>

        <div class="card">
            <div class="section-title">çµç®— (è² æ•¸ = æ¬ éŒ¢)</div>
            <div id="debtList"></div>
        </div>

        <div class="card">
            <div class="section-title">æ˜ç´°</div>
            <div id="expenseList"></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay" onclick="closeModal()"></div>
    <div class="modal-sheet" id="modalSheet">
        <div class="modal-drag"></div>
        <div class="modal-scroll" id="modalContent"></div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="nav('pre', this)"><i class="fas fa-clipboard-check"></i> è¡Œå‰</div>
        <div class="nav-item" onclick="nav('itinerary', this)"><i class="fas fa-map-location-dot"></i> è¡Œç¨‹</div>
        <div class="nav-item" onclick="nav('info', this)"><i class="fas fa-hotel"></i> è³‡è¨Š</div>
        <div class="nav-item" onclick="nav('money', this)"><i class="fas fa-wallet"></i> è¨˜å¸³</div>
    </nav>

<script>
    // --- DATA ---
    const users = ['L', 'K', 'R', 'Y', 'J'];
    let curUser = 'L';
    let curPayer = 'L';

    // 1. å…¨å“¡å¾…è¾¦
    const commonTodos = [
        { text: "ç§Ÿè»Šé ç´„ (ETC + SEP)", done: false },
        { text: "Visit Japan Web", done: false },
        { text: "å°è±†å³¶æ¸¡è¼ªé ç´„ (å«è»Š)", done: false },
        { text: "é¦™å·å„ªæƒ åˆ¸ç™»è¨˜", link: "https://cheng-ya.deeeep.com.tw/index.php" },
        { text: "é³´é–€è§€æ½®èˆ¹ / æ —æ—å…¬åœ’èˆ¹", done: false },
        { text: "GoGo æ»‘ç´¢é ç´„", done: false }
    ];

    // 2. å€‹äººæ¸…å–®
    const checklistData = {
        carry: ['è­·ç…§', 'éŒ¢åŒ…', 'æ‰‹æ©Ÿ', 'ç¶²å¡/eSIM', 'è¡Œå‹•é›»æº', 'æ°´å£º', 'é˜²æ›¬ä¹³', 'å¤–å¥—', 'è€³æ©Ÿ', 'å¢¨é¡', 'ç­†', 'é¢ç´™'],
        check: ['è¡£ç‰©', 'å…§è¡£è¤²', 'ç¡è¡£', 'è¥ªå­', 'å‚™ç”¨é‹', 'æ‹–é‹', 'å……é›»å™¨', 'è‡ªæ‹æ£’', 'è—¥å“', 'æ³³è¡£(L7)', 'ç›¥æ´—åŒ…', 'æŒ‡ç”²å‰ª', 'é›¨å…·', 'è³¼ç‰©è¢‹', 'ç‰™åˆ·']
    };

    // 3. ä½å®¿è³‡æ–™
    const hotels = [
        { name: "Second Home ç€¬æˆ¸é¢¨æœˆ", date: "2/27-3/2", desc: "11é»é€€æˆ¿ | é™„è»Šä½*2 | å¯†ç¢¼é–", mapcode: "77 353 678*81", img: "https://images.unsplash.com/photo-1590073844006-33379778ae09?auto=format&fit=crop&q=80&w=600" },
        { name: "Kowakuen Haruka å¤æ¹§åœ’ é™", date: "3/2-3/3", desc: "15é»CI/11é»CO | å«æ—©é¤ | é“å¾Œæº«æ³‰", mapcode: "", img: "https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?auto=format&fit=crop&q=80&w=600" },
        { name: "OMO7 é«˜çŸ¥", date: "3/3-3/6", desc: "å«æ—©é¤ | å¤œä¾†ç¥­è¡¨æ¼”", mapcode: "", img: "https://images.unsplash.com/photo-1566073771259-6a8506099945?auto=format&fit=crop&q=80&w=600" },
        { name: "å¾¡å®¿ æ•·å³¶é¤¨", date: "3/6-3/7", desc: "ä¸€æ³ŠäºŒé£Ÿ | 22é»å…è²»æ‹‰éºµ | ç§äººæ¹¯å±‹", mapcode: "", img: "https://images.unsplash.com/photo-1611892440504-42a792e24d32?auto=format&fit=crop&q=80&w=600" }
    ];

    // 4. å®Œæ•´ 9 å¤©è¡Œç¨‹
    const itinerary = [
        {
            date: "02/27", day: "äº”", loc: "é«˜æ¾", hotel: "Second Home",
            items: [
                { time: "10:30", title: "æŠµé”é«˜æ¾æ©Ÿå ´", tag: "transport", desc: "é ˜å–å„ªæƒ åˆ¸ã€ç§Ÿè»Š (ETC+SEP)ã€‚", guide: "å‡ºé—œå¾Œå…ˆå»é ˜å–è¯èˆªé¦™å·å„ªæƒ åˆ¸ã€‚ç§Ÿè»Šæ«ƒå°åœ¨å…¥å¢ƒå¤§å»³ï¼Œè¨˜å¾—å‡ºç¤ºé ç´„å–®ä¸¦ç¢ºèªå·²åŠ è³¼ SEPã€‚" },
                { time: "12:30", title: "æ‰‹æ‰“çƒé¾éºµ æ£®å®¶", tag: "food", desc: "å¿…é»ç‚¸ä»€éŒ¦ã€‚Kawataé€±äº”ä¼‘æ”¹æ­¤ã€‚", mapcode: "77 166 459*22",
                  img: "https://images.unsplash.com/photo-1612927601601-6606a9b461e1?auto=format&fit=crop&q=80&w=600",
                  guide: "åœ¨åœ°äººæ¨è–¦ååº—ã€‚ç‰¹è‰²æ˜¯ç¾ç‚¸çš„å¤§ç‰‡ä»€éŒ¦å¤©å©¦ç¾…ã€‚<br>å¿…é»ï¼š<b>Kakiage Oroshi (ç‚¸ä»€éŒ¦è˜¿è””æ³¥çƒé¾éºµ)</b>ã€‚",
                  menu: [{jp:"ã‹ãæšã’ãŠã‚ã—ã†ã©ã‚“", zh:"ç‚¸ä»€éŒ¦è˜¿è””æ³¥çƒé¾éºµ"}, {jp:"ã¶ã£ã‹ã‘ã†ã©ã‚“", zh:"æ¿ƒæ¹¯çƒé¾éºµ"}] },
                { time: "13:45", title: "å‘†å‘†ç¸å…¬åœ’", tag: "sight", desc: "å¯¶å¯å¤¢è¿·å¿…å»ï¼Œç¶¾å·ã€‚", guide: "ä½æ–¼ç¶¾å·ç”ºï¼Œæ—é‚Šæœ‰å…è²»åœè»Šå ´ã€‚å¾ˆå¤šå¯¶å¯å¤¢è¨­æ–½ï¼Œåœç•™30åˆ†æ‹ç…§ã€‚" },
                { time: "14:30", title: "é‡‘åˆ€æ¯”ç¾…å®®", tag: "sight", desc: "æŒ‘æˆ°785éšã€‚17:00é—œé–€ã€‚", mapcode: "77 353 678*81",
                  img: "https://images.unsplash.com/photo-1624625807963-c7df94639904?auto=format&fit=crop&q=80&w=600",
                  guide: "ä¸€ç”Ÿå¿…åƒæ‹œã€‚å¾¡æœ¬å®®785éšï¼Œå¥§ç¤¾1368éšã€‚æ²¿é€”å¯ä»¥è²·ã€Œç¸é¥…é ­ã€ã€‚<br>âš ï¸ æ³¨æ„ï¼š17:00 é—œé–€ã€‚", info:{"åœè»Š":"ç´å¹³å…¬åœ’åœè»Šå ´", "é–€ç¥¨":"å…è²»"} },
                { time: "18:00", title: "æ°¸æ—ºå¤¢æ¨‚åŸ", tag: "shop", desc: "æ™šé¤èˆ‡è£œçµ¦ã€‚", guide: "å››åœ‹æœ€å¤§ AEONã€‚å»ºè­°å…ˆè²·é½Šé€™å¹¾å¤©çš„è»Šä¸Šé›¶é£Ÿé£²æ–™ã€‚æ™šé¤ç¾é£Ÿè¡—è§£æ±ºã€‚" }
            ]
        },
        {
            date: "02/28", day: "å…­", loc: "å°è±†å³¶", hotel: "Second Home",
            items: [
                { time: "07:20", title: "é«˜æ¾æ¸¯å‡ºç™¼", tag: "transport", desc: "æ¸¡è¼ªå¾€åœŸåº„æ¸¯ (ç´„60åˆ†)ã€‚", guide: "è«‹ææ—©30åˆ†é˜æŠµé”è¾¦ç†è»Šè¼›ç™»èˆ¹ã€‚èˆ¹ä¸Šæœ‰è³£çƒé¾éºµã€‚" },
                { time: "09:00", title: "æ©„æ¬–å…¬åœ’", tag: "sight", desc: "é­”å¥³å®…æ€¥ä¾¿æƒæŠŠæ‰“å¡ã€‚", guide: "éŠå®¢ä¸­å¿ƒå¯<b>å…è²»ç§Ÿå€Ÿé­”æ³•æƒæŠŠ</b>ã€‚å¿…åƒç¶ è‰²çš„æ©„æ¬–éœœæ·‡æ·‹ã€‚" },
                { time: "12:00", title: "HISHIO æ‹‰éºµ", tag: "food", desc: "å¤©ä½¿ä¹‹è·¯åº—ã€‚åŠ éºµå…è²»ã€‚", guide: "æ‹›ç‰Œæ˜¯é†¬æ²¹æ‹‰éºµã€‚ç‰¹è‰²æ˜¯<b>æ›¿ç‰ (åŠ éºµ) ç„¡é™æ¬¡å…è²»</b>ï¼", menu:[{jp:"é†¤ãã°", zh:"é†¬æ²¹æ‹‰éºµ"}, {jp:"æ›¿ç‰", zh:"åŠ éºµ"}] },
                { time: "13:45", title: "å¤©ä½¿ä¹‹è·¯", tag: "sight", desc: "âš ï¸ é€€æ½®æ™‚é–“ï¼š13:45~19:45ã€‚", img:"https://images.unsplash.com/photo-1599926464673-c6039c3230a5?auto=format&fit=crop&q=80&w=600", guide: "åªæœ‰é€€æ½®æ™‚æ²™æ´²æœƒæµ®ç¾ï¼Œå¯ä»¥èµ°åˆ°å°é¢ä¸­ä½™å³¶ã€‚æˆ€äººè–åœ°ã€‚" },
                { time: "15:45", title: "è¿”å›é«˜æ¾", tag: "transport", desc: "æ­ä¹˜å‘†å‘†ç¸è™Ÿæ¸¡è¼ªã€‚", guide: "èˆ¹èº«æœ‰æ»¿æ»¿çš„å‘†å‘†ç¸åœ–æ¡ˆï¼Œéå¸¸å¥½æ‹ã€‚" },
                { time: "17:00", title: "é«˜æ¾åŸ (ç‰è—»å…¬åœ’)", tag: "sight", desc: "ä¸‰å¤§æ°´åŸï¼Œé¤µé¯›é­šã€‚", guide: "è­·åŸæ²³å¼•é€²æµ·æ°´ï¼Œæ‰€ä»¥è£¡é¢æ˜¯é¯›é­šï¼å¯ä»¥è²·é£¼æ–™é¤µé­šã€‚" }
            ]
        },
        {
            date: "03/01", day: "æ—¥", loc: "å¾·å³¶", hotel: "Second Home",
            items: [
                { time: "09:00", title: "æ —æ—å…¬åœ’", tag: "sight", desc: "å·²é ç´„éŠèˆ¹ã€‚", mapcode: "60 576 348*55", guide: "ç±³å…¶æ—ä¸‰æ˜Ÿåº­åœ’ã€‚æˆ‘å€‘é ç´„äº† 09:00 çš„å—æ¹–å‘¨éŠå’Œèˆ¹ï¼Œè«‹å‹¿é²åˆ°ã€‚" },
                { time: "11:30", title: "é³´é–€æ¼©æ¸¦", tag: "sight", desc: "âš ï¸ å¤§æ½®æœ€ä½³è§€è³æ™‚é–“ï¼", img:"https://images.unsplash.com/photo-1572949645841-094f3a9c4c94?auto=format&fit=crop&q=80&w=600", guide: "æœ¬æ—¥æœ€ä½³è§€æ½®æ™‚é–“æ˜¯ 11:30ã€‚å»ºè­°èµ°ã€Œæ¸¦ä¹‹é“ã€(å¤§æ©‹ä¸‹ç»ç’ƒæ­¥é“) æˆ–æ­è§€æ½®èˆ¹ã€‚", info:{"æ¸¦ä¹‹é“":"510å††", "è§€æ½®èˆ¹":"1800å††"} },
                { time: "12:30", title: "å ‚ã®æµ¦ é³´é–€æœ¬åº—", tag: "food", desc: "é¯›é­šé¹½å‘³æ‹‰éºµã€‚", guide: "çƒ¤é¯›é­šéª¨ç†¬çš„æ¹¯é ­ï¼Œè¶…é®®ï¼<br>ğŸ”¥ å…§è¡Œåƒæ³•ï¼šåƒå®ŒéºµåŠ é»<b>ã€Œæ›¿é£¯ã€</b>ï¼Œè®Šæˆèµ·å¸ç‡‰é£¯ã€‚", menu:[{jp:"é¯›å¡©ãƒ©ãƒ¼ãƒ¡ãƒ³", zh:"é¯›é­šé¹½å‘³æ‹‰éºµ"}, {jp:"æ›¿é£¯", zh:"ç‚¸é­šçš®èµ·å¸é£¯"}] },
                { time: "15:30", title: "çœ‰å±±çºœè»Š", tag: "sight", desc: "é˜¿æ³¢èˆæœƒé¤¨5æ¨“æ­ä¹˜ã€‚", mapcode: "56 361 036*63", guide: "å¯ä¿¯ç°å¾·å³¶å¸‚æ™¯ï¼Œå¤©æ°£å¥½èƒ½çœ‹åˆ°æ·¡è·¯å³¶ã€‚" }
            ]
        },
        {
            date: "03/02", day: "ä¸€", loc: "æ¾å±±", hotel: "å¤æ¹§åœ’ é™",
            items: [
                { time: "08:45", title: "é•·ç”° in é¦™ã®é¦™", tag: "food", desc: "çƒé¾éºµç™¾ååº— No.2ã€‚", mapcode: "77 132 233*36", guide: "ä»¥<b>é‡œæšçƒé¾éºµ</b>èå (æ²¾ç†±é†¬æ±åƒ)ã€‚æ¹¯é ­æ˜¯å¤§ç“¶è£è‡ªå·±å€’ã€‚", menu:[{jp:"é‡œã‚ã’ã†ã©ã‚“", zh:"é‡œæšçƒé¾éºµ"}] },
                { time: "10:30", title: "ä¸¸é¾œåŸ", tag: "sight", desc: "ç¾å­˜å¤©å®ˆï¼Œå¥½æ¼¢å¡ã€‚", guide: "æ“æœ‰æ—¥æœ¬æœ€é«˜çš„çŸ³å£ã€‚çˆ¬ä¸Šå»æœ‰é»é™¡ï¼Œè«‹ç©¿å¥½èµ°çš„é‹ã€‚" },
                { time: "13:00", title: "é«˜å±‹ç¥ç¤¾", tag: "sight", desc: "å¤©ç©ºé³¥å±…ã€‚", guide: "é›–ç„¶å¹³æ—¥å¯é–‹è»Šä¸Šå»ï¼Œä½†è·¯<b>éå¸¸çª„</b>ï¼Œè«‹å°å¿ƒé§•é§›ã€‚" },
                { time: "15:00", title: "æ¾å±±åŸ", tag: "sight", desc: "æ­å–®äººåŠæ¤…ä¸Šå±±ã€‚", guide: "æ¨è–¦æ­å–®äººåŠæ¤… (Chair Lift)ï¼Œè…³ä¸‹æ‡¸ç©ºå¾ˆæ¶¼çˆ½ï¼å¤©å®ˆé–£è¦–é‡æ¥µä½³ã€‚" },
                { time: "18:00", title: "é“å¾Œæº«æ³‰", tag: "sight", desc: "ç¥éš±å°‘å¥³æ¹¯å±‹ã€‚", guide: "æ—¥æœ¬æœ€å¤è€æº«æ³‰ã€‚å¿…çœ‹æ•´é»çš„å°‘çˆºæ©Ÿé—œé˜ã€‚å¿…é€›ä¼Šç¹”æ¯›å·¾ã€‚" }
            ]
        },
        {
            date: "03/03", day: "äºŒ", loc: "é«˜çŸ¥", hotel: "OMO7 é«˜çŸ¥",
            items: [
                { time: "10:00", title: "ä¸‹ç˜è»Šç«™", tag: "sight", desc: "æµ·ä¸Šéµé“ã€‚", guide: "ç¥éš±å°‘å¥³æµ·ä¸Šåˆ—è»Šå ´æ™¯ã€‚ç„¡äººè»Šç«™ï¼Œè«‹å®‰éœæ‹ç…§ã€‚" },
                { time: "13:00", title: "å¤§æ´²åŸ & æ²¹å±‹", tag: "food", desc: "åˆé¤ï¼šè±šæ —é£¯ã€‚", guide: "æ¨è–¦æ²¹å±‹çš„<b>è±šæ —é£¯</b>ï¼Œæ˜¯å¤§æ´²è—©ä¸»çš„æ–™ç†ã€‚" },
                { time: "19:00", title: "å¼˜äººå¸‚å ´", tag: "food", desc: "é«˜çŸ¥äººçš„å»šæˆ¿ï¼", img:"https://images.unsplash.com/photo-1579618037324-4f25b2927237?auto=format&fit=crop&q=80&w=600", guide: "æ°£æ°›è¶…å—¨ã€‚è¦å‰‡ï¼š<b>å…ˆä½”ä½ï¼Œå†é»é¤</b>ã€‚<br>ğŸ”¥ å¿…åƒï¼šæ˜ç¥ä¸¸ç‚™ç‡’é°¹é­š(é¹½å‘³)ã€å®‰å…µè¡›é¤ƒå­ã€‚", menu:[{jp:"é°¹ã®ã‚¿ã‚¿ã‚­ (å¡©)", zh:"ç‚™ç‡’é°¹é­š(é¹½å‘³)"}, {jp:"å±‹å°é¤ƒå­", zh:"ä¸€å£é¤ƒå­"}] }
            ]
        },
        {
            date: "03/04", day: "ä¸‰", loc: "å››è¬å", hotel: "OMO7 é«˜çŸ¥",
            items: [
                { time: "10:30", title: "å››è¬åå·", tag: "sight", desc: "æ—¥æœ¬æœ€å¾Œæ¸…æµã€‚", guide: "å»ºè­°å»è§€å…‰å”æœƒç§Ÿè…³è¸è»Šï¼Œé¨å»<b>ä½ç”°æ²‰ä¸‹æ©‹</b>ã€‚ä¹Ÿå¯ä»¥æ­å±‹å½¢èˆ¹ã€‚" },
                { time: "18:00", title: "ä¿ºã®ä¸² ãªãŠã•ã‚“", tag: "food", desc: "åœ¨åœ°ä¸²ç‡’ã€‚", guide: "é«˜çŸ¥å¸‚å€çš„ä¸²ç‡’ååº—ï¼Œé©åˆå–ä¸€æ¯ã€‚" }
            ]
        },
        {
            date: "03/05", day: "å››", loc: "é«˜çŸ¥å¸‚", hotel: "OMO7 é«˜çŸ¥",
            items: [
                { time: "09:00", title: "é«˜çŸ¥åŸ", tag: "sight", desc: "è¿½æ‰‹é–€èˆ‡å¤©å®ˆåŒæ¡†ã€‚", guide: "æ—¥æœ¬å”¯ä¸€èƒ½æŠŠå¤§é–€å’Œå¤©å®ˆé–£æ‹åœ¨åŒæ¡†çš„åŸã€‚" },
                { time: "11:00", title: "æ¡‚æ¿±å…¬åœ’", tag: "sight", desc: "å‚æœ¬é¾é¦¬åƒã€‚", guide: "æ—é‚Šçš„<b>æ¡‚æ¿±æ°´æ—é¤¨</b>å¯ä»¥é¤µé£Ÿæµ·ç…ï¼Œäº’å‹•æ€§è¶…é«˜ï¼" },
                { time: "14:00", title: "ç‰§é‡æ¤ç‰©åœ’", tag: "sight", desc: "æ—¥åŠ‡ã€Šçˆ›æ¼«ã€‹å ´æ™¯ã€‚", guide: "æº«å®¤å»ºç¯‰å¾ˆç¾ï¼Œæ˜¯ç¶²ç¾æ‰“å¡é»ã€‚" },
                { time: "19:00", title: "åœŸä½æ–™ç† å¸", tag: "food", desc: "ç™¾å¹´è€åº—ã€‚", guide: "æƒ³åƒæ­£çµ±çš¿é‰¢æ–™ç†æˆ–é¯¨é­šæ–™ç†é¦–é¸é€™å®¶ã€‚" }
            ]
        },
        {
            date: "03/06", day: "äº”", loc: "ç¥–è°·", hotel: "å¾¡å®¿ æ•·å³¶é¤¨",
            items: [
                { time: "09:00", title: "å¤§æ­¥å±éŠè¦½èˆ¹", tag: "sight", desc: "æ¬£è³å³½è°·å¥‡å²©ã€‚", guide: "èˆ¹ç¨‹ç´„ 30 åˆ†é˜ï¼Œå¯ä»¥è²·é£¼æ–™é¤µé´¨å­ã€‚" },
                { time: "10:30", title: "GoGo Adventure", tag: "sight", desc: "æ£®æ—æ»‘ç´¢ï¼", guide: "âš ï¸ <b>éœ€é ç´„</b>ã€‚é£›è¶Šç¥–è°·å·çš„è¶…é•·æ»‘ç´¢ï¼Œéå¸¸åˆºæ¿€ï¼å‹™å¿…ç©¿é‹å‹•é‹ã€‚" },
                { time: "13:00", title: "ç¥–è°·è—¤è”“æ©‹", tag: "sight", desc: "æ—¥æœ¬ä¸‰å¤§å¥‡æ©‹ã€‚", guide: "ç”¨è—¤è”“ç·¨çš„åŠæ©‹ï¼Œè…³ä¸‹ç¸«éš™å¾ˆå¤§ï¼Œè€ƒé©—è†½é‡ï¼éæ©‹è²» 550 å††ã€‚" },
                { time: "16:00", title: "æ•·å³¶é¤¨ Check-in", tag: "hotel", desc: "äº«å—æº«æ³‰ã€‚", guide: "ä½æ–¼ç´å¹³è¡¨åƒé“ã€‚æ™šä¸Š 22:00 æœ‰å…è²»æ‹‰éºµã€‚é¤¨å…§æœ‰å…è²»ç§äººæ¹¯å±‹ã€‚" }
            ]
        },
        {
            date: "03/07", day: "å…­", loc: "è¿”å°", hotel: "æº«æš–çš„å®¶",
            items: [
                { time: "09:00", title: "é«˜æ¾æ©Ÿå ´", tag: "transport", desc: "é‚„è»Šã€å…ç¨…åº—ã€‚", guide: "é–‹è»Šè‡³æ©Ÿå ´ç´„ 50 åˆ†é˜ã€‚é‚„è»Šå‰è¨˜å¾—åŠ æ»¿æ²¹ã€‚" },
                { time: "18:55", title: "CI 179 èµ·é£›", tag: "transport", desc: "Bye Bye å››åœ‹ï¼", guide: "é è¨ˆ 21:05 æŠµé”æ¡ƒåœ’ã€‚" }
            ]
        }
    ];

    // --- JS Logic ---
    let curUser = 'L';
    let curPayer = 'L';

    function init() {
        renderTodos();
        renderUserTabs();
        renderChecklist();
        renderDates();
        selectDay(0);
        renderHotels();
        renderExpenseUI();
    }

    // 1. è¡Œå‰æº–å‚™
    function renderTodos() {
        document.getElementById('common-todos').innerHTML = commonTodos.map(t => `
            <div class="todo-item" onclick="this.querySelector('.todo-checkbox').classList.toggle('checked')">
                <div class="todo-checkbox"><i>âœ“</i></div>
                <div style="flex:1">
                    <div style="font-weight:500; ${t.link?'color:var(--primary); cursor:pointer;':''}" onclick="${t.link?`window.open('${t.link}')`:''}">${t.text} ${t.link?'<i class="fas fa-external-link-alt" style="font-size:0.7rem"></i>':''}</div>
                </div>
            </div>`).join('');
    }
    function renderUserTabs() {
        document.getElementById('userSwitch').innerHTML = users.map(u => 
            `<div class="user-tab ${u===curUser?'active':''}" onclick="curUser='${u}'; renderUserTabs(); renderChecklist();">${u}</div>`
        ).join('');
    }
    function renderChecklist() {
        const saved = JSON.parse(localStorage.getItem('check_'+curUser)) || {};
        ['carry','check'].forEach(type => {
            document.getElementById('list-'+type).innerHTML = checklistData[type].map(item => {
                const checked = saved[item] ? 'checked' : '';
                let icon = 'fa-suitcase';
                if(item.includes('è­·ç…§')) icon='fa-passport';
                if(item.includes('éŒ¢åŒ…')) icon='fa-wallet';
                if(item.includes('æ‰‹æ©Ÿ')) icon='fa-mobile-screen';
                return `<div class="check-item ${checked}" onclick="toggleCheck('${item}', this)"><i class="fas ${icon}"></i><span>${item}</span></div>`;
            }).join('');
        });
    }
    function toggleCheck(item, el) {
        const saved = JSON.parse(localStorage.getItem('check_'+curUser)) || {};
        if(saved[item]) { delete saved[item]; el.classList.remove('checked'); }
        else { saved[item] = true; el.classList.add('checked'); }
        localStorage.setItem('check_'+curUser, JSON.stringify(saved));
    }

    // 2. è¡Œç¨‹
    function renderDates() {
        document.getElementById('dayScroller').innerHTML = itinerary.map((d, i) => `
            <div class="date-chip ${i===0?'active':''}" onclick="selectDay(${i}, this)">
                <div class="day">Day ${i+1}</div>
                <div class="date">${d.date.split('/')[1]}</div>
            </div>
        `).join('');
    }
    function selectDay(idx, el) {
        if(el) {
            document.querySelectorAll('.date-chip').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
        }
        const data = itinerary[idx];
        document.getElementById('weatherCity').innerText = data.loc + "å¸‚";
        document.getElementById('stayHotel').innerText = data.hotel;
        
        // Weather Strip
        let wHtml = '';
        for(let h=9; h<=21; h+=2) {
            wHtml += `<div style="text-align:center; min-width:50px;"><div style="font-size:0.7rem; color:#888;">${h}:00</div><div style="font-size:1.2rem; margin:5px 0;"><i class="fas fa-${h>17?'moon':'cloud-sun'}" style="color:${h>17?'#5E35B1':'#FFB300'}"></i></div><div style="font-weight:700;">${10+Math.floor(Math.random()*5)}Â°</div></div>`;
        }
        document.getElementById('weatherStrip').innerHTML = wHtml;

        // Timeline
        document.getElementById('timelineList').innerHTML = data.items.map((item, i) => `
            <div class="timeline-item" onclick="openModal(${idx}, ${i})">
                <div class="tl-time">${item.time}</div>
                <div class="tl-card">
                    <div class="tl-tag tag-${item.tag}">${item.tag.toUpperCase()}</div>
                    <div class="section-title" style="margin-bottom:5px; font-size:1rem;">${item.title}</div>
                    <div style="font-size:0.85rem; color:#666;">${item.desc}</div>
                </div>
            </div>
        `).join('');
    }

    // 3. Modal
    function openModal(dayIdx, itemIdx) {
        const item = itinerary[dayIdx].items[itemIdx];
        document.body.classList.add('body-no-scroll');
        document.getElementById('modalOverlay').classList.add('active');
        document.getElementById('modalSheet').classList.add('active');
        
        let html = `
            ${item.img ? `<img src="${item.img}" class="modal-img">` : ''}
            <h2 style="font-size:1.5rem; margin:0 0 10px;">${item.title}</h2>
            <div style="color:#888; font-size:0.9rem; margin-bottom:20px;">${item.time} â€¢ ${item.tag.toUpperCase()}</div>
            
            ${item.guide ? `<div style="background:#F2F2F7; padding:15px; border-radius:12px; margin-bottom:20px; line-height:1.6;">${item.guide}</div>` : ''}
            
            ${item.info ? `<div class="info-grid">${Object.entries(item.info).map(([k,v])=>`<div class="info-box"><div style="font-size:0.7rem; color:#888;">${k}</div><div style="font-weight:700;">${v}</div></div>`).join('')}</div>` : ''}
            
            ${item.menu ? `<div class="menu-box"><h4 style="margin:0 0 10px;">ğŸ´ å¿…é»èœå–®</h4>${item.menu.map(m=>`<div style="display:flex; justify-content:space-between; margin-bottom:5px; border-bottom:1px dashed #ccc; padding-bottom:5px;"><span style="font-weight:700;">${m.jp}</span><span style="font-size:0.9rem;">${m.zh}</span></div>`).join('')}</div>` : ''}
            
            <div style="display:flex; gap:10px;">
                ${item.mapcode ? `<button class="btn" style="background:#333;" onclick="copy('${item.mapcode}')">è¤‡è£½ Mapcode</button>` : ''}
                <button class="btn" onclick="window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.title)}')">Google å°èˆª</button>
            </div>
            <div style="height:50px;"></div>
        `;
        document.getElementById('modalContent').innerHTML = html;
    }
    function closeModal() {
        document.body.classList.remove('body-no-scroll');
        document.getElementById('modalOverlay').classList.remove('active');
        document.getElementById('modalSheet').classList.remove('active');
    }

    // 4. ä½å®¿
    function renderHotels() {
        document.getElementById('hotelList').innerHTML = hotels.map(h => `
            <div class="hotel-card">
                <img src="${h.img}" class="hotel-img-header">
                <div class="hotel-body">
                    <h3 style="margin:0 0 5px;">${h.name}</h3>
                    <div style="color:#888; font-size:0.85rem; margin-bottom:10px;">${h.date}</div>
                    <div style="font-size:0.9rem;">${h.desc}</div>
                    ${h.mapcode ? `<div class="hotel-tag" onclick="copy('${h.mapcode}')">Code: ${h.mapcode}</div>` : ''}
                </div>
            </div>
        `).join('');
    }

    // 5. è¨˜å¸³
    let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
    function renderExpenseUI() {
        document.getElementById('payerSwitch').innerHTML = users.map(u => `<div class="payer-chip ${u===curPayer?'active':''}" onclick="curPayer='${u}'; renderExpenseUI();">${u}</div>`).join('');
        
        let bal = {L:0, K:0, R:0, Y:0, J:0};
        expenses.forEach(e => {
            let share = e.cost/5;
            users.forEach(u => { if(u===e.payer) bal[u]+=e.cost-share; else bal[u]-=share; });
        });
        
        document.getElementById('debtList').innerHTML = users.map(u => {
            let val = Math.round(bal[u]);
            let color = val>=0 ? '#34C759' : '#FF3B30';
            return `<div class="debt-row"><span>${u}</span><span style="color:${color}; font-weight:700;">${val>=0?'æ”¶':'ä»˜'} Â¥${Math.abs(val)}</span></div>`;
        }).join('');

        document.getElementById('expenseList').innerHTML = expenses.map((e,i) => `
            <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee;">
                <div><div style="font-weight:600;">${e.name}</div><div style="font-size:0.8rem; color:#888;">${e.payer} ä»˜æ¬¾</div></div>
                <div style="text-align:right;"><div style="font-weight:700;">Â¥${e.cost}</div><div style="font-size:0.8rem; color:red;" onclick="delExp(${i})">åˆªé™¤</div></div>
            </div>
        `).join('');
    }
    function addExpense() {
        const name = document.getElementById('exName').value;
        const cost = parseInt(document.getElementById('exCost').value);
        if(!name || !cost) return alert('è«‹è¼¸å…¥è³‡æ–™');
        expenses.push({name, cost, payer:curPayer});
        localStorage.setItem('expenses', JSON.stringify(expenses));
        renderExpenseUI();
        document.getElementById('exName').value=''; document.getElementById('exCost').value='';
    }
    function delExp(i) { if(confirm('åˆªé™¤?')) { expenses.splice(i,1); localStorage.setItem('expenses', JSON.stringify(expenses)); renderExpenseUI(); } }

    function nav(page, el) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.getElementById('page-'+page).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
        el.classList.add('active');
        window.scrollTo(0,0);
    }
    function copy(txt) { navigator.clipboard.writeText(txt); alert('å·²è¤‡è£½: '+txt); }

    init();
</script>
</body>
</html>