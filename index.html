<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 å››åœ‹å·¡ç¦®</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#F5F5F7">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #F5F5F7;
            --card: #FFFFFF;
            --primary: #2c3e50;
            --accent: #3498db;
            --text: #1d1d1f;
            --text-gray: #86868b;
            --shadow: 0 4px 20px rgba(0,0,0,0.06);
            --radius: 20px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding-bottom: 120px;
            overscroll-behavior-y: none; /* é˜²æ­¢ iOS æ©¡çš®ç­‹æ•ˆæœ */
        }

        /* é–å®šèƒŒæ™¯æ²å‹• (ç•¶ Modal é–‹å•Ÿæ™‚) */
        body.body-no-scroll { overflow: hidden; }

        /* --- Header --- */
        .header {
            padding: 50px 24px 20px;
            background: var(--bg);
        }
        .header h1 {
            font-size: 2.2rem; font-weight: 900; margin: 0; letter-spacing: -1px; color: var(--primary);
        }
        .header p {
            margin: 5px 0 0; color: var(--text-gray); font-size: 0.9rem; font-weight: 500;
        }

        /* --- Components --- */
        .page { display: none; padding: 0 20px; animation: fadeUp 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--card); border-radius: var(--radius); padding: 24px;
            margin-bottom: 16px; box-shadow: var(--shadow);
        }
        .section-title {
            font-size: 1.1rem; font-weight: 800; margin-bottom: 16px; 
            display: flex; align-items: center; gap: 10px; color: var(--primary);
        }

        /* éš±è—å¼é€£çµæ¨£å¼ */
        .stealth-link {
            text-decoration: none; color: inherit; cursor: pointer;
            border-bottom: 1px dashed #ccc; padding-bottom: 2px;
        }

        /* --- Pre-Trip Page --- */
        .todo-item {
            display: flex; align-items: flex-start; gap: 12px; padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .todo-item:last-child { border-bottom: none; }
        .todo-checkbox {
            width: 20px; height: 20px; border-radius: 6px; border: 2px solid #ddd;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;
            transition: 0.2s;
        }
        .todo-checkbox.checked { background: var(--accent); border-color: var(--accent); }
        .todo-checkbox i { color: white; font-size: 12px; display: none; }
        .todo-checkbox.checked i { display: block; }
        
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .check-box {
            background: #f9f9f9; padding: 15px 5px; border-radius: 12px;
            text-align: center; font-size: 0.85rem; cursor: pointer; border: 2px solid transparent;
            display: flex; flex-direction: column; align-items: center; gap: 8px;
        }
        .check-box i { font-size: 1.2rem; color: #ccc; } /* é€™è£¡æ§åˆ¶ Icon é¡è‰² */
        .check-box.checked { background: #e3f2fd; border-color: var(--accent); color: var(--accent); }
        .check-box.checked i { color: var(--accent); }

        /* --- Itinerary Page --- */
        /* Date Scroller */
        .date-scroller {
            display: flex; gap: 10px; overflow-x: auto; padding: 10px 20px 20px; margin: 0 -20px;
            scrollbar-width: none;
        }
        .date-pill {
            flex: 0 0 auto; background: white; padding: 10px 0; width: 75px;
            border-radius: 30px; text-align: center; border: 2px solid transparent;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: 0.2s; cursor: pointer;
        }
        .date-pill .day-label { font-size: 0.7rem; color: var(--text-gray); font-weight: 600; text-transform: uppercase; }
        .date-pill .date-num { font-size: 1.1rem; font-weight: 900; color: var(--text); line-height: 1.2; }
        .date-pill.active { background: var(--primary); transform: scale(1.05); box-shadow: 0 8px 15px rgba(44,62,80,0.3); }
        .date-pill.active .day-label, .date-pill.active .date-num { color: white; }

        /* Weather Strip */
        .weather-row {
            display: flex; gap: 20px; overflow-x: auto; padding-bottom: 10px;
            border-bottom: 1px solid #eee; margin-bottom: 15px; scrollbar-width: none;
        }
        .w-col { text-align: center; min-width: 45px; }
        .w-time { font-size: 0.75rem; color: var(--text-gray); margin-bottom: 5px; }
        .w-icon { font-size: 1.2rem; margin-bottom: 5px; color: #f39c12; }
        .w-temp { font-weight: 700; font-size: 0.9rem; }

        /* Timeline */
        .timeline-item {
            display: flex; gap: 15px; margin-bottom: 20px; cursor: pointer;
        }
        .tl-time {
            width: 50px; text-align: right; font-family: 'Roboto Mono', monospace;
            font-weight: 600; color: var(--text-gray); padding-top: 12px; font-size: 0.9rem;
        }
        .tl-card {
            flex: 1; background: white; padding: 16px; border-radius: 18px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.03); position: relative;
            transition: transform 0.1s; border: 1px solid rgba(0,0,0,0.02);
        }
        .tl-card:active { transform: scale(0.98); background: #f8f9fa; }
        .tl-tag {
            display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 700; margin-bottom: 6px;
        }
        .tag-food { background: #fff3cd; color: #856404; }
        .tag-sight { background: #d4edda; color: #155724; }
        .tag-transport { background: #cce5ff; color: #004085; }
        .tag-shop { background: #f8d7da; color: #721c24; }
        
        .tl-title { font-size: 1.05rem; font-weight: 700; margin-bottom: 4px; line-height: 1.3; }
        .tl-desc { font-size: 0.85rem; color: var(--text-gray); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* --- Modal (Bottom Sheet) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; opacity: 0; pointer-events: none; transition: 0.3s;
            backdrop-filter: blur(4px);
        }
        .modal-sheet {
            position: fixed; left: 0; right: 0; bottom: 0; height: 90vh; /* ä½”æ»¿ 90% */
            background: white; z-index: 2001; border-radius: 24px 24px 0 0;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-sheet.active { transform: translateY(0); }
        
        .modal-drag { width: 40px; height: 5px; background: #e0e0e0; border-radius: 10px; margin: 12px auto; flex-shrink: 0; }
        .modal-scroll { flex: 1; overflow-y: auto; padding: 0 24px 40px; -webkit-overflow-scrolling: touch; }
        
        .modal-img { width: 100%; height: 220px; object-fit: cover; border-radius: 16px; margin-bottom: 20px; background: #eee; }
        .guide-box { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid var(--accent); }
        .guide-title { font-weight: 700; color: var(--primary); margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .menu-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #ddd; padding: 8px 0; }
        
        /* --- Bottom Nav --- */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            background: rgba(30, 30, 30, 0.9); backdrop-filter: blur(20px);
            border-radius: 40px; padding: 12px 0; display: flex; justify-content: space-around;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 1000;
        }
        .nav-btn { text-align: center; color: #888; font-size: 0.7rem; flex: 1; transition: 0.3s; cursor: pointer; }
        .nav-btn i { display: block; font-size: 1.4rem; margin-bottom: 4px; }
        .nav-btn.active { color: white; transform: translateY(-2px); }

    </style>
</head>
<body>

    <header class="header">
        <h1>2026 å››åœ‹å·¡ç¦®</h1>
        <p>L, K, R, Y, J â€¢ 9å¤©8å¤œè‡ªé§•å†’éšª</p>
    </header>

    <div id="page-pre" class="page active">
        <div class="card" style="border: 2px solid var(--primary);">
            <div class="section-title"><i class="fas fa-bullhorn"></i> å…¨å“¡é‡è¦å¾…è¾¦</div>
            <div id="all-todos">
                </div>
        </div>

        <div class="card">
            <div class="section-title">
                <i class="fas fa-user-check"></i> å€‹äººè¡Œææª¢æŸ¥
                <select id="userSelect" onchange="switchUser(this.value)" style="margin-left:auto; padding:5px; border-radius:8px; font-size:1rem;">
                    <option value="L">L</option><option value="K">K</option><option value="R">R</option><option value="Y">Y</option><option value="J">J</option>
                </select>
            </div>
            
            <h4 style="color:#888; margin:10px 0;">éš¨èº«æ”œå¸¶</h4>
            <div class="grid-3" id="list-carry"></div>
            
            <h4 style="color:#888; margin:20px 0 10px;">è¨—é‹è¡Œæ</h4>
            <div class="grid-3" id="list-check"></div>
        </div>
    </div>

    <div id="page-itinerary" class="page">
        <div class="date-scroller" id="dayScroller"></div>

        <div class="card" style="margin-top: 15px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <div class="section-title" style="margin:0;"><i class="fas fa-cloud-sun-rain"></i> 24H é å ±</div>
                <span id="weatherLoc" style="color:#888; font-size:0.9rem;">é«˜æ¾å¸‚</span>
            </div>
            <div class="weather-row" id="weatherStrip"></div>
            <div style="text-align:right; font-size:0.8rem; color:#888;">
                ä»Šæ™šå…¥ä½ï¼š<strong id="stayHotel" style="color:var(--primary);">...</strong>
            </div>
        </div>

        <div id="timelineList"></div>
    </div>

    <div class="modal-overlay" id="modalOverlay" onclick="closeModal()"></div>
    <div class="modal-sheet" id="modalSheet">
        <div class="modal-drag"></div>
        <div class="modal-scroll" id="modalContent">
            </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-btn active" onclick="nav('pre', this)"><i class="fas fa-list-check"></i> è¡Œå‰</div>
        <div class="nav-btn" onclick="nav('itinerary', this)"><i class="fas fa-map-location-dot"></i> è¡Œç¨‹</div>
        </div>

<script>
    // --- DATA: å…¨å“¡å¾…è¾¦ ---
    const allTodos = [
        { text: "ç§Ÿè»Šé ç´„ (ETC + SEP é«˜é€Ÿåƒåˆ°é£½)", sub: "è·¨ç¸£ç§»å‹•å¿…è²· SEP æ¯”è¼ƒåˆ’ç®—" },
        { text: "Visit Japan Web å¡«å¯«", sub: "æ¯äººéƒ½è¦å¡«ï¼Œæˆªåœ– QR code" },
        { text: "å°è±†å³¶æ¸¡è¼ªé ç´„", sub: "éœ€åŒ…å«è»Šè¼›é ç´„" },
        { text: "é¦™å·å„ªæƒ åˆ¸ç™»è¨˜", link: "https://cheng-ya.deeeep.com.tw/index.php" },
        { text: "é³´é–€è§€æ½®èˆ¹ / æ —æ—å…¬åœ’èˆ¹ç¥¨", sub: "ç†±é–€æ™‚æ®µéœ€æ¶ç¥¨" },
        { text: "GoGo æ»‘ç´¢é ç´„", sub: "ç¥–è°·è¡Œç¨‹å¿…å‚™" }
    ];

    // --- DATA: è¡Œç¨‹ (åŒ…å«å°éŠè©³ç´°ä»‹ç´¹) ---
    const itinerary = [
        {
            date: "02/27", day: "äº”", loc: "é«˜æ¾", hotel: "Second Home ç€¬æˆ¸é¢¨æœˆ",
            items: [
                { time: "10:30", title: "æŠµé”é«˜æ¾æ©Ÿå ´", tag: "transport", desc: "é ˜å–å„ªæƒ åˆ¸ã€ç§Ÿè»Šã€‚", 
                  guide: "å‡ºé—œå¾Œå…ˆå»é ˜å–è¯èˆªé¦™å·å„ªæƒ åˆ¸ã€‚ç§Ÿè»Šæ«ƒå°åœ¨å…¥å¢ƒå¤§å»³ï¼Œè¨˜å¾—å‡ºç¤ºé ç´„å–®ä¸¦ç¢ºèªå·²åŠ è³¼ SEP (Sanuki Expressway Pass)ã€‚" },
                { time: "12:30", title: "æ‰‹æ‰“çƒé¾éºµ æ£®å®¶", tag: "food", desc: "ç‚¸ä»€éŒ¦çƒé¾éºµååº—ã€‚", mapcode: "77 166 459*22",
                  img: "https://images.unsplash.com/photo-1612927601601-6606a9b461e1?auto=format&fit=crop&q=80&w=600",
                  guide: "åŸå®š Kawata Udon å› é€±äº”ä¼‘æ¯ï¼Œæ”¹åƒé€™å®¶åœ¨åœ°äººæ¨è–¦çš„æ£®å®¶ (Moriya)ã€‚<br>âš ï¸ å¿…é»ï¼š<b>Kakiage Oroshi (ç‚¸ä»€éŒ¦è˜¿è””æ³¥çƒé¾éºµ)</b>ï¼Œä»½é‡è¶…å¤§ï¼",
                  menu: [{jp:"ã‹ãæšã’ãŠã‚ã—ã†ã©ã‚“", zh:"ç‚¸ä»€éŒ¦è˜¿è””æ³¥çƒé¾éºµ"}, {jp:"ã¶ã£ã‹ã‘ã†ã©ã‚“", zh:"æ¿ƒæ¹¯çƒé¾éºµ"}] },
                { time: "13:45", title: "å‘†å‘†ç¸å…¬åœ’", tag: "sight", desc: "å¯¶å¯å¤¢è¿·å¿…å»æ‰“å¡é»ã€‚", 
                  guide: "ä½æ–¼ç¶¾å·ç”ºï¼Œæ—é‚Šæœ‰å…è²»åœè»Šå ´ã€‚é™¤äº†å‘†å‘†ç¸ï¼Œé‚„æœ‰å¾ˆå¤šå¯¶å¯å¤¢å…ƒç´ çš„éŠæ¨‚è¨­æ–½ï¼Œé è¨ˆåœç•™ 30 åˆ†é˜æ‹ç…§ã€‚" },
                { time: "14:30", title: "é‡‘åˆ€æ¯”ç¾…å®®", tag: "sight", desc: "æŒ‘æˆ° 785 éšæ¢¯ï¼", mapcode: "77 353 678*81",
                  img: "https://images.unsplash.com/photo-1624625807963-c7df94639904?auto=format&fit=crop&q=80&w=600",
                  guide: "æ—¥æœ¬äººä¸€ç”Ÿå¿…å»çš„åƒæ‹œåœ°ã€‚å¾è¡¨åƒé“åˆ°å¾¡æœ¬å®®å…± 785 éšï¼Œè‹¥è¦åˆ°å¥§ç¤¾å‰‡æ˜¯ 1368 éšã€‚<br>ğŸ’¡ <b>å°æ’‡æ­¥ï¼š</b>åœ¨ç™»å±±å£å¯ä»¥ç§Ÿå€Ÿç™»å±±æ–ã€‚æ²¿é€”æœ‰å¾ˆå¤šåº—å®¶å¯ä»¥è²·ã€Œç¸é¥…é ­ã€ã€‚<br>âš ï¸ 17:00 é—œé–€ï¼Œè«‹æ³¨æ„æ™‚é–“ã€‚",
                  info: {"é–€ç¥¨":"å…è²»åƒæ‹œ", "åœè»Š":"ç´å¹³å…¬åœ’åœè»Šå ´", "é–‹æ”¾":"06:00-17:00"} },
                { time: "18:00", title: "æ°¸æ—ºå¤¢æ¨‚åŸ", tag: "shop", desc: "æ™šé¤èˆ‡è£œçµ¦ã€‚", 
                  guide: "å››åœ‹æœ€å¤§çš„ AEON Mallã€‚æ™šé¤åœ¨ç¾é£Ÿè¡—è§£æ±ºã€‚å»ºè­°å…ˆå»è¶…å¸‚è²·é€™å¹¾å¤©è»Šä¸Šè¦åƒçš„é›¶é£Ÿé£²æ–™ï¼Œé‚„æœ‰ Uniqlo/GU ä¹Ÿåœ¨é€™ã€‚", 
                  info: {"ç‡Ÿæ¥­":"10:00-21:00"} }
            ]
        },
        {
            date: "02/28", day: "å…­", loc: "å°è±†å³¶", hotel: "Second Home",
            items: [
                { time: "07:20", title: "é«˜æ¾æ¸¯å‡ºç™¼", tag: "transport", desc: "æ¸¡è¼ªå‰å¾€åœŸåº„æ¸¯ã€‚", 
                  guide: "è«‹ææ—© 20-30 åˆ†é˜æŠµé”æ¸¯å£è¾¦ç†è»Šè¼›ç™»èˆ¹æ‰‹çºŒã€‚èˆ¹ç¨‹ç´„ 60 åˆ†é˜ï¼Œèˆ¹ä¸Šæœ‰è³£çƒé¾éºµã€‚" },
                { time: "09:00", title: "æ©„æ¬–å…¬åœ’", tag: "sight", desc: "é­”å¥³å®…æ€¥ä¾¿æ‹æ”åœ°ã€‚", 
                  guide: "å¿…åšï¼šå»éŠå®¢ä¸­å¿ƒ<b>å…è²»ç§Ÿå€Ÿé­”æ³•æƒæŠŠ</b>ï¼Œåœ¨ç™½è‰²é¢¨è»Šå‰æ‹è·³èºç…§ã€‚<br>å¿…åƒï¼šæ©„æ¬–éœœæ·‡æ·‹ (ç¶ è‰²çš„)ã€‚" },
                { time: "12:00", title: "HISHIO æ‹‰éºµ", tag: "food", desc: "å¤©ä½¿ä¹‹è·¯åº—ã€‚", 
                  guide: "å°±åœ¨å¤©ä½¿ä¹‹è·¯æ—ã€‚æ‹›ç‰Œæ˜¯ã€Œé†¬æ²¹æ‹‰éºµ (Hishio Soba)ã€ï¼Œæ¹¯é ­æ¿ƒéƒã€‚é€™è£¡çš„ç‰¹é»æ˜¯<b>æ›¿ç‰ (åŠ éºµ) å…è²»ç„¡é™æ¬¡</b>ï¼" },
                { time: "13:45", title: "å¤©ä½¿ä¹‹è·¯", tag: "sight", desc: "æˆ€äººçš„è–åœ°ã€‚", 
                  img: "https://images.unsplash.com/photo-1599926464673-c6039c3230a5?auto=format&fit=crop&q=80&w=600",
                  guide: "âš ï¸ <b>é—œéµæ™‚åˆ»ï¼š</b> ä»Šå¤©é€€æ½®æ™‚é–“ç´„ 13:45~19:45ã€‚åªæœ‰é€™æ®µæ™‚é–“æ²™æ´²æœƒæµ®ç¾ï¼Œå¯ä»¥èµ°åˆ°å°é¢çš„ä¸­ä½™å³¶ã€‚ä¸€å®šè¦ç‰½æ‰‹èµ°éå»ï¼" },
                { time: "17:00", title: "é«˜æ¾åŸ (ç‰è—»å…¬åœ’)", tag: "sight", desc: "æ—¥æœ¬ä¸‰å¤§æ°´åŸã€‚", 
                  guide: "å›åˆ°é«˜æ¾æ¸¯å¾Œé †è·¯å»ã€‚ç‰¹è‰²æ˜¯è­·åŸæ²³å¼•é€²æµ·æ°´ï¼Œæ‰€ä»¥è£¡é¢æ¸¸çš„æ˜¯<b>é¯›é­š</b>ï¼å¯ä»¥è²·é£¼æ–™é¤µé­šã€‚" }
            ]
        },
        {
            date: "03/01", day: "æ—¥", loc: "å¾·å³¶", hotel: "Second Home",
            items: [
                { time: "09:00", title: "æ —æ—å…¬åœ’", tag: "sight", desc: "ç±³å…¶æ—ä¸‰æ˜Ÿåº­åœ’ã€‚", mapcode: "60 576 348*55",
                  guide: "å››åœ‹æœ€ç¾åº­åœ’ã€‚æˆ‘å€‘é ç´„äº† 09:00 çš„<b>å—æ¹–å‘¨éŠå’Œèˆ¹</b>ï¼Œè«‹å‹¿é²åˆ°ã€‚èˆ¹å¤«æœƒè¬›è§£æ­·ä»£è—©ä¸»çš„é›…è¶£ã€‚" },
                { time: "11:30", title: "é³´é–€æ¼©æ¸¦", tag: "sight", desc: "å¤§æ½®æœ€ä½³è§€è³æ™‚é–“ï¼", 
                  img: "https://images.unsplash.com/photo-1572949645841-094f3a9c4c94?auto=format&fit=crop&q=80&w=600",
                  guide: "âš ï¸ <b>çµ•å°æº–æ™‚ï¼š</b> ä»Šå¤©çš„æœ€ä½³è§€æ½®æ™‚é–“æ˜¯ 11:30ã€‚å»ºè­°å»èµ°ã€Œæ¸¦ä¹‹é“ã€(å¤§æ©‹ä¸‹çš„ç»ç’ƒæ­¥é“) æˆ–æ˜¯æ­ä¹˜è§€æ½®èˆ¹è¿‘è·é›¢é«”é©—ã€‚", 
                  info: {"æ¸¦ä¹‹é“é–€ç¥¨":"510å††", "è§€æ½®èˆ¹":"ç´„1800å††"} },
                { time: "12:30", title: "å ‚ã®æµ¦ é³´é–€æœ¬åº—", tag: "food", desc: "é¯›é­šé¹½å‘³æ‹‰éºµã€‚", 
                  guide: "å¾·å³¶å¿…åƒååº—ã€‚æ¹¯é ­æ˜¯ç”¨çƒ¤é¯›é­šéª¨ç†¬çš„ï¼Œéå¸¸é®®ï¼<br>ğŸ”¥ <b>å…§è¡Œåƒæ³•ï¼š</b> éºµåƒå®Œå¾Œï¼Œé»ä¸€ç¢—ã€Œæ›¿é£¯ (Kaemeshi)ã€ï¼ŒæŠŠåŠ äº†èµ·å¸è›‹çš„é£¯å€’é€²æ¹¯è£¡è®Šç‡‰é£¯ã€‚",
                  menu: [{jp:"é¯›å¡©ãƒ©ãƒ¼ãƒ¡ãƒ³", zh:"é¯›é­šé¹½å‘³æ‹‰éºµ"}, {jp:"æ›¿é£¯", zh:"ç‚¸é¯›é­šçš®èµ·å¸é£¯"}] },
                { time: "15:30", title: "çœ‰å±±çºœè»Š", tag: "sight", desc: "ä¿¯ç°å¾·å³¶å¸‚ã€‚", mapcode: "56 361 036*63",
                  guide: "æ­ä¹˜çºœè»Šä¸Šå±± (é˜¿æ³¢èˆæœƒé¤¨5æ¨“)ã€‚å¤©æ°£å¥½å¯ä»¥çœ‹åˆ°æ·¡è·¯å³¶ã€‚ä¸‹å±±å¾Œå¯ä»¥é †ä¾¿é€›é˜¿æ³¢èˆæœƒé¤¨ã€‚" }
            ]
        },
        {
            date: "03/02", day: "ä¸€", loc: "æ¾å±±", hotel: "å¤æ¹§åœ’ é™",
            items: [
                { time: "08:45", title: "é•·ç”° in é¦™ã®é¦™", tag: "food", desc: "çƒé¾éºµç™¾ååº— No.2ã€‚", mapcode: "77 132 233*36",
                  guide: "é€™å®¶æ˜¯ä»¥<b>é‡œæšçƒé¾éºµ (Kamaage)</b> èåï¼Œå°±æ˜¯æ²¾é†¬æ±åƒçš„ç†±çƒé¾éºµã€‚æ¹¯é ­æ˜¯å¤§ç“¶è£è‡ªå·±å€’çš„ï¼Œéå¸¸ç‰¹åˆ¥ã€‚",
                  menu: [{jp:"é‡œã‚ã’ã†ã©ã‚“ (å¤§/å°)", zh:"é‡œæšçƒé¾éºµ (å»ºè­°é»å°)"}] },
                { time: "10:30", title: "ä¸¸é¾œåŸ", tag: "sight", desc: "çŸ³å£ååŸã€‚", 
                  guide: "æ—¥æœ¬ç¾å­˜ 12 å¤©å®ˆä¹‹ä¸€ã€‚ç‰¹è‰²æ˜¯æ“æœ‰æ—¥æœ¬æœ€é«˜çš„çŸ³å£ï¼Œéå¸¸å£¯è§€ã€‚çˆ¬ä¸Šå»çš„è·¯ç¨å¾®æœ‰é»é™¡ (å¥½æ¼¢å¡)ã€‚" },
                { time: "15:00", title: "æ¾å±±åŸ", tag: "sight", desc: "æ­å–®äººåŠæ¤…ä¸Šå±±ã€‚", 
                  guide: "æ¨è–¦æ­ä¹˜<b>å–®äººåŠæ¤… (Chair Lift)</b> ä¸Šå±±ï¼Œè…³ä¸‹æ‡¸ç©ºå¾ˆæ¶¼çˆ½ï¼(ä¹Ÿæœ‰è»Šå»‚å¼çºœè»Šå¯é¸)ã€‚å¤©å®ˆé–£è¦–é‡æ¥µä½³ã€‚" },
                { time: "18:00", title: "é“å¾Œæº«æ³‰", tag: "sight", desc: "ç¥éš±å°‘å¥³æ¹¯å±‹ã€‚", 
                  guide: "æ—¥æœ¬æœ€å¤è€æº«æ³‰ã€‚æ•´é»æœƒæœ‰ã€Œå°‘çˆºæ©Ÿé—œé˜ã€è¡¨æ¼”ã€‚å¿…é€›å•†åº—è¡—çš„<b>ä¼Šç¹”æ¯›å·¾</b>å’Œ<b>æ©˜å­æ±æ°´é¾é ­</b>ã€‚" }
            ]
        },
        {
            date: "03/03", day: "äºŒ", loc: "é«˜çŸ¥", hotel: "OMO7 é«˜çŸ¥",
            items: [
                { time: "10:00", title: "ä¸‹ç˜è»Šç«™", tag: "sight", desc: "æµ·ä¸Šéµé“ã€‚", 
                  guide: "ç¥éš±å°‘å¥³æµ·ä¸Šåˆ—è»Šçš„åŸå‹å ´æ™¯ã€‚ç„¡äººè»Šç«™ï¼Œè«‹ä¿æŒå®‰éœã€‚æœ€ä½³æ‹ç…§é»æ˜¯ååœ¨é•·æ¤…ä¸ŠèƒŒå°æµ·ã€‚" },
                { time: "13:00", title: "å¤§æ´²åŸ & æ²¹å±‹", tag: "food", desc: "åˆé¤ï¼šè±šæ —é£¯ã€‚", 
                  guide: "å¤§æ´²åŸæ˜¯æœ¨é€ å¾©åŸå¤©å®ˆã€‚åˆé¤æ¨è–¦ã€Œæ²¹å±‹ã€çš„<b>è±šæ —é£¯ (Tonkuri Mabushi)</b>ï¼Œæ˜¯ä»¥å‰å¤§æ´²è—©ä¸»åƒçš„æ–™ç†ã€‚" },
                { time: "19:00", title: "å¼˜äººå¸‚å ´", tag: "food", desc: "é«˜çŸ¥äººçš„å»šæˆ¿ï¼", 
                  img: "https://images.unsplash.com/photo-1579618037324-4f25b2927237?auto=format&fit=crop&q=80&w=600",
                  guide: "æ°£æ°›è¶…å—¨çš„ç¾é£Ÿå»£å ´ã€‚è¦å‰‡ï¼š<b>å…ˆä½”ä½å­ï¼Œå†å»å„æ”¤é»é¤</b>ã€‚åƒå®Œé¤ç›¤æ”¾æ¡Œä¸Šï¼Œæœƒæœ‰äººæ”¶ã€‚<br>ğŸ”¥ å¿…åƒï¼š<b>æ˜ç¥ä¸¸</b>çš„ç¨»è‰ç‡’é°¹é­š(é»é¹½å‘³)ã€<b>å®‰å…µè¡›</b>çš„å±‹å°é¤ƒå­ã€‚",
                  menu: [{jp:"é°¹ã®ã‚¿ã‚¿ã‚­ (å¡©)", zh:"ç‚™ç‡’é°¹é­š (é¹½å‘³)"}, {jp:"å±‹å°é¤ƒå­", zh:"ä¸€å£ç…é¤ƒ"}] }
            ]
        },
        {
            date: "03/04", day: "ä¸‰", loc: "å››è¬å", hotel: "OMO7 é«˜çŸ¥",
            items: [
                { time: "10:30", title: "å››è¬åå·", tag: "sight", desc: "æ—¥æœ¬æœ€å¾Œçš„æ¸…æµã€‚", 
                  guide: "å»ºè­°è¡Œç¨‹ï¼šå»ã€Œå››è¬åå¸‚è§€å…‰å”æœƒã€ç§Ÿè…³è¸è»Šï¼Œé¨å»<b>ä½ç”°æ²‰ä¸‹æ©‹</b>(æœ€æœ‰åçš„ä¸€åº§)ã€‚å¦‚æœæœ‰æ™‚é–“å¯ä»¥æ­ä¹˜å±‹å½¢èˆ¹ã€‚" },
                { time: "18:00", title: "ä¿ºã®ä¸² ãªãŠã•ã‚“", tag: "food", desc: "åœ¨åœ°ä¸²ç‡’ã€‚", guide: "ä½æ–¼é«˜çŸ¥å¸‚å€çš„ä¸²ç‡’ååº—ï¼Œé©åˆå–ä¸€æ¯æ”¾é¬†ã€‚" }
            ]
        },
        {
            date: "03/05", day: "å››", loc: "é«˜çŸ¥å¸‚", hotel: "OMO7 é«˜çŸ¥",
            items: [
                { time: "09:00", title: "é«˜çŸ¥åŸ", tag: "sight", desc: "è¿½æ‰‹é–€èˆ‡å¤©å®ˆåŒæ¡†ã€‚", guide: "æ—¥æœ¬å”¯ä¸€å¯ä»¥æŠŠè¿½æ‰‹é–€(å¤§é–€)å’Œå¤©å®ˆé–£æ‹åœ¨åŒä¸€å¼µç…§ç‰‡è£¡çš„åŸã€‚" },
                { time: "11:00", title: "æ¡‚æ¿±å…¬åœ’", tag: "sight", desc: "å‚æœ¬é¾é¦¬åƒã€‚", guide: "é¢å‘å¤ªå¹³æ´‹çš„å£¯é—Šæµ·æ™¯ã€‚æ—é‚Šçš„<b>æ¡‚æ¿±æ°´æ—é¤¨</b>å¾ˆæœ‰åï¼Œå¯ä»¥è¿‘è·é›¢é¤µé£Ÿæµ·ç…å’Œæµ·é¾œ (äº’å‹•æ€§è¶…é«˜)ã€‚" },
                { time: "14:00", title: "ç‰§é‡æ¤ç‰©åœ’", tag: "sight", desc: "æ—¥åŠ‡ã€Šçˆ›æ¼«ã€‹å ´æ™¯ã€‚", guide: "ç´€å¿µæ¤ç‰©å­¸ä¹‹çˆ¶ç‰§é‡å¯Œå¤ªéƒã€‚æº«å®¤å»ºç¯‰éå¸¸ç¾ï¼Œæ˜¯ç¶²ç¾æ‰“å¡é»ã€‚" },
                { time: "19:00", title: "åœŸä½æ–™ç† å¸", tag: "food", desc: "ç™¾å¹´è€åº—ã€‚", guide: "å¦‚æœæƒ³åƒæ­£çµ±çš„åœŸä½æ–™ç†(çš¿é‰¢æ–™ç†)æˆ–æ˜¯é¯¨é­šè‚‰æ–™ç†ï¼Œé€™å®¶æ˜¯é¦–é¸ã€‚" }
            ]
        },
        {
            date: "03/06", day: "äº”", loc: "ç¥–è°·", hotel: "å¾¡å®¿ æ•·å³¶é¤¨",
            items: [
                { time: "09:00", title: "å¤§æ­¥å±éŠè¦½èˆ¹", tag: "sight", desc: "æ¬£è³å³½è°·å¥‡å²©ã€‚", guide: "èˆ¹ç¨‹ç´„ 30 åˆ†é˜ï¼Œå¯ä»¥è²·é£¼æ–™é¤µé´¨å­å’Œé¯‰é­šã€‚æ™¯è‰²éå¸¸å£¯è§€ã€‚" },
                { time: "10:30", title: "GoGo Adventure", tag: "sight", desc: "æ£®æ—æ»‘ç´¢ï¼", 
                  guide: "âš ï¸ <b>éœ€é ç´„</b>ã€‚é£›è¶Šç¥–è°·å·çš„è¶…é•·æ»‘ç´¢ï¼Œéå¸¸åˆºæ¿€ï¼è«‹å‹™å¿…ç©¿è‘—é‹å‹•é‹ã€‚" },
                { time: "13:00", title: "ç¥–è°·è—¤è”“æ©‹", tag: "sight", desc: "æ—¥æœ¬ä¸‰å¤§å¥‡æ©‹ã€‚", guide: "ç”¨è—¤è”“ç·¨æˆçš„åŠæ©‹ï¼Œèµ°èµ·ä¾†æœƒæ–æ™ƒï¼Œè…³ä¸‹ç¸«éš™å¾ˆå¤§ï¼Œè€ƒé©—è†½é‡ï¼éæ©‹è²» 550 å††ã€‚" },
                { time: "16:00", title: "æ•·å³¶é¤¨ Check-in", tag: "hotel", desc: "ç´å¹³æº«æ³‰ã€‚", 
                  guide: "ä½æ–¼é‡‘åˆ€æ¯”ç¾…å®®è¡¨åƒé“ä¸Šã€‚ä¸€æ³ŠäºŒé£Ÿã€‚è¨˜å¾—æ™šä¸Š 22:00-23:00 æœ‰<b>å…è²»çš„å¤œé³´æ‹‰éºµ</b>å¯ä»¥åƒï¼é¤¨å…§ä¹Ÿæœ‰å…è²»çš„ç§äººæ¹¯å±‹ã€‚" }
            ]
        },
        {
            date: "03/07", day: "å…­", loc: "è¿”å°", hotel: "æº«æš–çš„å®¶",
            items: [
                { time: "09:00", title: "é«˜æ¾æ©Ÿå ´", tag: "transport", desc: "é‚„è»Šã€å…ç¨…åº—ã€‚", guide: "é–‹è»Šè‡³æ©Ÿå ´ç´„ 50 åˆ†é˜ã€‚é‚„è»Šå‰è¨˜å¾—åŠ æ»¿æ²¹ã€‚æ©Ÿå ´ 2F æœ‰çƒé¾éºµé«˜æ¹¯æ°´é¾é ­å¯ä»¥å–ï¼" },
                { time: "18:55", title: "CI 179 èµ·é£›", tag: "transport", desc: "Bye Bye å››åœ‹ï¼", guide: "é è¨ˆ 21:05 æŠµé”æ¡ƒåœ’æ©Ÿå ´ã€‚" }
            ]
        }
    ];

    // --- LOGIC: è¡Œå‰æ¸…å–® ---
    const users = ['L', 'K', 'R', 'Y', 'J'];
    let curUser = 'L';
    
    function renderPreTrip() {
        // 1. å…¨å“¡å¾…è¾¦
        const todoContainer = document.getElementById('all-todos');
        todoContainer.innerHTML = allTodos.map(item => `
            <div class="todo-item" onclick="toggleCommonTodo(this)">
                <div class="todo-checkbox"><i>âœ“</i></div>
                <div style="flex:1;">
                    <div style="${item.link?'color:var(--accent); font-weight:700;':''}">${item.link ? `<a href="${item.link}" target="_blank" class="stealth-link">${item.text} <i class="fas fa-external-link-alt" style="font-size:0.7rem;"></i></a>` : item.text}</div>
                    ${item.sub ? `<div style="font-size:0.8rem; color:#888;">${item.sub}</div>` : ''}
                </div>
            </div>
        `).join('');

        // 2. å€‹äººæ¸…å–®
        renderPersonalList();
    }

    function switchUser(u) { curUser = u; renderPersonalList(); }

    function renderPersonalList() {
        const checklistData = {
            carry: ['è­·ç…§', 'éŒ¢åŒ…', 'æ‰‹æ©Ÿ', 'ç¶²å¡/eSIM', 'è¡Œå‹•é›»æº', 'æ°´å£º', 'é˜²æ›¬ä¹³', 'å¤–å¥—', 'è€³æ©Ÿ', 'å¢¨é¡', 'ç­†', 'é¢ç´™', 'ç‰™ç·š'],
            check: ['è¡£ç‰©', 'å…§è¡£è¤²', 'ç¡è¡£', 'è¥ªå­', 'å‚™ç”¨é‹', 'æ‹–é‹', 'å……é›»å™¨', 'è‡ªæ‹æ£’', 'å€‹äººè—¥å“', 'æ³³è¡£(L7)', 'ç›¥æ´—åŒ…', 'æŒ‡ç”²å‰ª', 'é›¨å…·', 'å»¶é•·ç·š', 'è³¼ç‰©è¢‹', 'ç‰™åˆ·']
        };
        const saved = JSON.parse(localStorage.getItem('check_'+curUser)) || {};

        ['carry', 'check'].forEach(type => {
            document.getElementById('list-'+type).innerHTML = checklistData[type].map(item => {
                const isChecked = saved[item] ? 'checked' : '';
                // let icon = 'fa-suitcase'; 
                if(item.includes('è­·ç…§')) icon='fa-passport';
                if(item.includes('éŒ¢åŒ…')) icon='fa-wallet';
                if(item.includes('æ‰‹æ©Ÿ')) icon='fa-mobile-screen';
                if(item.includes('è¡£')) icon='fa-shirt';
                
                return `
                <div class="check-box ${isChecked}" onclick="togglePersonalCheck('${item}', this)">
                    <i class="fas ${icon}"></i>
                    <span>${item}</span>
                </div>`;
            }).join('');
        });
    }

    function toggleCommonTodo(el) {
        el.querySelector('.todo-checkbox').classList.toggle('checked');
    }

    function togglePersonalCheck(item, el) {
        const saved = JSON.parse(localStorage.getItem('check_'+curUser)) || {};
        if(saved[item]) { delete saved[item]; el.classList.remove('checked'); }
        else { saved[item] = true; el.classList.add('checked'); }
        localStorage.setItem('check_'+curUser, JSON.stringify(saved));
    }

    // --- LOGIC: è¡Œç¨‹è¡¨ ---
    function renderItinerary() {
        // Render Date Scroller
        document.getElementById('dayScroller').innerHTML = itinerary.map((d, i) => `
            <div class="date-pill ${i===0?'active':''}" onclick="selectDay(${i}, this)">
                <div class="day-label">Day ${i+1}</div>
                <div class="date-num">${d.date.split('/')[1]}</div>
            </div>
        `).join('');
        selectDay(0, document.querySelector('.date-pill'));
    }

    function selectDay(idx, el) {
        // UI Active State
        document.querySelectorAll('.date-pill').forEach(e => e.classList.remove('active'));
        if(el) el.classList.add('active');

        const data = itinerary[idx];
        document.getElementById('stayHotel').innerText = data.hotel;
        document.getElementById('weatherLoc').innerText = data.loc + "å¸‚";

        // Render Timeline
        document.getElementById('timelineList').innerHTML = data.items.map((item, i) => `
            <div class="timeline-item" onclick="openModal(${idx}, ${i})">
                <div class="tl-time">${item.time}</div>
                <div class="tl-card">
                    <div class="tl-tag tag-${item.tag}">${item.tag.toUpperCase()}</div>
                    <div class="tl-title">${item.title}</div>
                    <div class="tl-desc">${item.desc}</div>
                </div>
            </div>
        `).join('');

        // Mock Weather
        let wHtml = '';
        for(let h=9; h<=21; h+=2) {
            wHtml += `
            <div class="w-col">
                <div class="w-time">${h}:00</div>
                <div class="w-icon"><i class="fas fa-${h>17?'moon':'cloud-sun'}"></i></div>
                <div class="w-temp">${10 + Math.floor(Math.random()*5)}Â°</div>
            </div>`;
        }
        document.getElementById('weatherStrip').innerHTML = wHtml;
    }

    // --- LOGIC: Modal ---
    function openModal(dayIdx, itemIdx) {
        const item = itinerary[dayIdx].items[itemIdx];
        const modal = document.getElementById('modalSheet');
        const content = document.getElementById('modalContent');
        
        // Prevent body scroll
        document.body.classList.add('body-no-scroll');

        let html = `
            ${item.img ? `<img src="${item.img}" class="modal-img">` : ''}
            <h2 style="font-size:1.8rem; margin:0 0 5px;">${item.title}</h2>
            <div style="color:#888; font-size:0.9rem; margin-bottom:20px;">${item.time} â€¢ ${item.tag.toUpperCase()}</div>
            
            ${item.guide ? `
                <div class="guide-box">
                    <div class="guide-title"><i class="fas fa-user-tie"></i> å°éŠç­†è¨˜</div>
                    <div style="line-height:1.6; color:#444;">${item.guide}</div>
                </div>` : ''}

            ${item.info ? `
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px;">
                    ${Object.entries(item.info).map(([k,v])=>`
                        <div style="background:#f0f0f0; padding:10px; border-radius:10px;">
                            <div style="font-size:0.7rem; color:#888;">${k}</div>
                            <div style="font-weight:700;">${v}</div>
                        </div>`).join('')}
                </div>` : ''}

            ${item.menu ? `
                <h4 style="margin:0 0 10px;">ğŸ´ å¿…é»èœå–® (æŒ‡çµ¦åº—å“¡çœ‹)</h4>
                <div style="background:#fff8e1; border:1px solid #ffe082; padding:15px; border-radius:12px; margin-bottom:20px;">
                    ${item.menu.map(m => `
                        <div class="menu-row">
                            <span style="font-weight:700; color:#5d4037;">${m.jp}</span>
                            <span style="font-size:0.9rem; color:#888;">${m.zh}</span>
                        </div>`).join('')}
                </div>` : ''}

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                ${item.mapcode ? `<button class="btn" style="background:#333;" onclick="copy('${item.mapcode}')"><i class="fas fa-copy"></i> è¤‡è£½ Mapcode</button>` : ''}
                <button class="btn" style="background:#007aff;" onclick="openMap('${item.title}')"><i class="fas fa-location-arrow"></i> Google å°èˆª</button>
            </div>
            <div style="height:50px;"></div>
        `;
        
        content.innerHTML = html;
        document.getElementById('modalOverlay').classList.add('active');
        modal.classList.add('active');
    }

    function closeModal() {
        document.body.classList.remove('body-no-scroll');
        document.getElementById('modalOverlay').classList.remove('active');
        document.getElementById('modalSheet').classList.remove('active');
    }

    function nav(page, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-'+page).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        window.scrollTo(0,0);
    }

    function copy(txt) { navigator.clipboard.writeText(txt); alert('å·²è¤‡è£½ Mapcode: '+txt); }
    function openMap(q) { window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`); }

    // Init
    renderPreTrip();
    renderItinerary();

</script>
</body>
</html>